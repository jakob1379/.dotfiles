#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

if [ $# -lt 2 ]
then
    echo "pyenv-link: takes <local virt> <pyenv name>"
    exit 1
fi

thisdir="$PWD"
target="$PWD/virt"
name="$2"
pyenv_path="$PYENV_ROOT/versions/$name"

if [[ -L "$pyenv_path" ]] || [[ -e "$pyenv_path" ]]; then
    read  -p "symlink already exists - do you want to overwrite it? [y/N] " ans
    if [[ "$ans" == "y" ]] || [[ "$ans" == "Y" ]]; then
        ln -fs "$target" "$pyenv_path"
    fi
else
    ln -s "$target" "$pyenv_path"
fi

read -p "add .python-version file? [y/N] " ans

if [ "$ans" == 'y' ] || [ "$ans" == 'Y' ]; then
    pyenv local "$name"
fi
